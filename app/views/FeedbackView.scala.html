@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.Feedback.FeedbackType
@import models.Feedback.FeedbackType.*
@import models.user.UserModel
@import views.html.components.IconsLink

@this(
    layout: templates.Layout,
    formHelper: FormWithCSRF,
    govukButton: GovukButton,
    govukErrorSummary: GovukErrorSummary,
    govukInput: GovukInput,
    govukTextarea: GovukTextarea,
    govukRadios: GovukRadios,
    iconsLink: IconsLink
)

@(form: Form[?], user: Option[UserModel])(implicit request: Request[?], messages: Messages)

@userEmail = @{form("allowContactEmail").value.orElse(user.map(_.email))}

@layout(
    pageTitle = messages("feedback.title"),
    fullWidth = true,
    timeout   = false,
    user      = user,
    customScriptsBlock = Some(iconsLink()),
    activeLink = None
) {
    <h1 class="govuk-heading-xl govuk-!-margin-bottom-2" id="feedbackHeading">@messages("feedback.heading")</h1>

    <p class="govuk-body govuk-!-margin-bottom-5">@Html(messages("feedback.intro"))</p>

    @formHelper(action = routes.FeedbackController.onSubmit(), Symbol("autoComplete") -> "off") {
        @if(form.errors.nonEmpty) {
            @govukErrorSummary(ErrorSummaryViewModel(form))
        }

        @govukRadios(
            RadiosViewModel(
                field = form("type"),
                items = Seq(
                    RadioItem(
                        content = Text(messages(s"feedback.type.${General.toString.toLowerCase()}")),
                        value = Some(General.toString)
                    ),
                    RadioItem(
                        content = Text(messages(s"feedback.type.${FeatureSuggestion.toString.toLowerCase()}")),
                        value = Some(FeatureSuggestion.toString)
                    ),
                    RadioItem(
                        content = Text(messages(s"feedback.type.${Other.toString.toLowerCase()}")),
                        value = Some(Other.toString),
                        conditionalHtml = Some(
                            govukInput(
                                InputViewModel(
                                    field = form("otherType"),
                                    label = LabelViewModel("")
                                )
                            )
                        )
                    )
                ),
                fieldset = Fieldset(
                    legend = Some(Legend(
                        content = messages("feedback.type.title"),
                        classes = "govuk-fieldset__legend--m",
                        isPageHeading = true
                    ))
                )
            )
        )

        @govukRadios(
            RadiosViewModel(
                field = form("rate"),
                items = Seq(
                    RadioItem(
                        content = Text("1"),
                        value = Some("1"),
                    ),
                    RadioItem(
                        content = Text("2"),
                        value = Some("2"),
                    ),
                    RadioItem(
                        content = Text("3"),
                        value = Some("3"),
                    ),
                    RadioItem(
                        content = Text("4"),
                        value = Some("4"),
                    ),
                    RadioItem(
                        content = Text("5"),
                        value = Some("5"),
                    )
                ),
                fieldset = Fieldset(
                    legend = Some(Legend(
                        content = messages("feedback.rate.title"),
                        classes = "govuk-fieldset__legend--m",
                        isPageHeading = true
                    ))
                    )
            ).withCssClass("govuk-radios--inline")
            .withAttribute("data-before" -> messages("feedback.rate.before"))
            .withAttribute("data-after" -> messages("feedback.rate.after"))
        )

        @govukTextarea(Textarea(
            id = "feedback-comments",
            name = "comments",
            value = form("comments").value,
            label = Label(
                isPageHeading = true,
                classes = "govuk-fieldset__legend--m",
                content = Text(messages("feedback.comments.title"))
            ),
        ))

        @govukRadios(
            RadiosViewModel(
                field = form("allowContact"),
                legend = LegendViewModel(messages("feedback.allowContact.title"))
                    .withCssClass("govuk-fieldset__legend--m"),
                items = Seq(
                    RadioItem(
                        content = Text(messages("site.yes")),
                        value = Some("true"),
                        conditionalHtml = Some(
                            govukInput(
                                InputViewModel(
                                    field = form("allowContactEmail"),
                                    label = LabelViewModel(messages("feedback.allowContactEmail.title")),
                                    value = userEmail
                                )
                            )
                        )
                    ),
                    RadioItem(
                        content = Text(messages("site.no")),
                        value = Some("false")
                    )
                )
            )
        )

        <button type="submit" class="govuk-button" data-module="govuk-button">
            @messages("site.submit")
        </button>
    }
}
