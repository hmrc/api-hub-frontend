@*
 * Copyright 2024 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.user.UserModel
@import models.team.Team
@import java.time.format.DateTimeFormatter
@import views.html.helper.CSPNonce

@this(
    layout: templates.Layout
)

@(teams: Seq[Team], user: UserModel)(implicit request: Request[_], messages: Messages)

@layout(
    pageTitle    = titleNoForm(messages("manageMyTeams.title")),
    showBackLink = true,
    user = Some(user)
) {

    <h1 class="govuk-heading-l">
        @messages("manageMyTeams.heading")
    </h1>

    <div class="govuk-hint">
        @messages("manageMyTeams.hint")
    </div>

    <div class="call-out-panel govuk-!-margin-top-7 govuk-!-margin-bottom-7">
        <div class="call-out-flex-header">
            <h2>@messages("manageMyTeams.yourTeams")</h2>
            <a href="@controllers.team.routes.CreateTeamStartController.startCreateTeam()" class="govuk-button">@messages("manageMyTeams.addNewTeam")</a>
        </div>

        <table class="govuk-table">
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header">@messages("manageMyTeams.headings.teamName")</th>
                    <th scope="col" class="govuk-table__header">@messages("manageMyTeams.headings.members")</th>
                    <th scope="col" class="govuk-table__header">@messages("manageMyTeams.headings.created")</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                @for(team <- teams) {
                    <tr class="govuk-table__row">
                        <th scope="row" class="govuk-table__header">
                            <a href="@controllers.team.routes.ManageTeamController.onPageLoad(team.id)" class="govuk-body govuk-link govuk-link--no-visited-state">@team.name</a>
                        </th>
                        <td class="govuk-table__cell">@team.teamMembers.size</td>
                        <td class="govuk-table__cell utcDateTime">@team.created.format(DateTimeFormatter.ISO_DATE_TIME)</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <script type="text/javascript" @CSPNonce.attr>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.utcDateTime').forEach(elUtcDateTime => {
                const date = new Date(elUtcDateTime.textContent),
                    isValidDate = !isNaN(date.valueOf());
                if (isValidDate) {
                    elUtcDateTime.textContent = date.toLocaleDateString(undefined, {day: "numeric", month: "short", year: "numeric"});
                } else {
                    console.warn(`Expected a valid date/time string but found "${utcDateTime.textContent}"`);
                }
            });
        });
    </script>

}
